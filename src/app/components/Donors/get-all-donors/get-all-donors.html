<p-toast />
<p-confirmDialog />

<div class="card">
    <p-toolbar class="mb-4">
        <ng-template #start>
            <p-button label="הוספת תורם חדש" icon="pi pi-user-plus" class="p-button-success" (onClick)="showChild()" />
        </ng-template>
    </p-toolbar>

    <p-table [value]="donors" [dataKey]="'id'" [rows]="10" [paginator]="true" [rowHover]="true"
        [expandedRowKeys]="expandedRows" (onRowExpand)="onRowExpand($event)" (onRowCollapse)="onRowCollapse($event)">
        <ng-template #header>
            <tr>
                <th style="width: 5rem"></th>
                <th>דוא"ל</th>
                <th pSortableColumn="First_Name">שם פרטי<p-sortIcon field="First_Name" /></th>
                <th pSortableColumn="Last_Name">שם משפחה<p-sortIcon field="Last_Name" /></th>
                <th pSortableColumn="Phone">מספר טלפון<p-sortIcon field="Phone" /></th>
                <th>סטטוס</th>
                <th>שם חברה</th>
                <th>תאור חברה</th>
                <th>לוגו</th>
                <th>פעולות</th>
            </tr>
        </ng-template>

        <ng-template #body let-d>
            <tr>
                <td>
                    <p-button type="button" pRipple [pRowToggler]="d" [text]="true" severity="secondary"
                        [rounded]="true" [icon]="expandedRows[d.id] ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
                </td>
                <td>{{ d.email }}</td>
                <td>{{ d.first_name }}</td>
                <td>{{ d.last_name }}</td>
                <td>{{ d.phone }}</td>
                <td>
                    <p-tag [severity]="d.Is_publish ? 'success' : 'warn'" [value]="d.is_publish ? 'מפורסם' : 'טיוטה'" />
                </td>
                <td>{{ d.company_name }}</td>
                <td>{{ d.company_description }}</td>
                @if(d.company_picture && d.company_picture !== '' && d.company_picture !== 'null') {
                <td>
                    <img [src]="IMAGE_BASE_URL + d.company_picture" style="width: 50px" class="shadow-2 rounded" />
                </td>
                }
                @else {
                <td>
                    <p-tag severity="info" value="אין לוגו" />
                </td>
                }
                <td>
                    <p-button icon="pi pi-pencil" [rounded]="true" [outlined]="true" class="mr-2"
                        (onClick)="editDonor(d)" />
                    <p-button icon="pi pi-trash" [rounded]="true" [outlined]="true" severity="danger"
                        (onClick)="deleteDonor(d)" />
                </td>
            </tr>
        </ng-template>
        <ng-template #expandedrow let-donor>
            <tr>
                <td colspan="10">
                    <div class="p-0">
                        <h5>Donations for {{ donor.First_name }} {{ donor.Last_name }}
                            <p-button label="הוספת מתנה חדשה" icon="pi pi-user-plus" class="p-button-success m-2 text-sm"
                                (onClick)="addGift(donor)" /></h5>
                        <p-table [value]="donor.donations" dataKey="id">
                            <ng-template #header>
            <tr>
             <th pSortableColumn="id">
                <div class="flex items-center gap-2">
                    Id
                    <p-sortIcon field="price" />
                </div>
                </th>
                <th pSortableColumn="customer">
                    <div class="flex items-center gap-2">
                        Name
                        <p-sortIcon field="customer" />
                    </div>
                </th>
                <th pSortableColumn="date">
                    <div class="flex items-center gap-2">
                        Description
                        <p-sortIcon field="date" />
                    </div>
                </th>
                <th pSortableColumn="amount">
                    <div class="flex items-center gap-2">
                        Details
                        <p-sortIcon field="amount" />
                    </div>
                </th>
                <th pSortableColumn="status">
                    <div class="flex items-center gap-2">
                        Picture
                        <p-sortIcon field="status" />
                    </div>
                </th>
                <th pSortableColumn="status">
                    <div class="flex items-center gap-2">
                        Num of bids
                        <p-sortIcon field="status" />
                    </div>
                </th>
                <th style="width: 4rem">
                    <div class="flex items-center gap-2">
                        Value
                    </div>
                </th>
                <th style="width: 4rem">
                    <div class="flex items-center gap-2">
                        Edit
                    </div>
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-donation>
            <tr>
                <td>{{ donation.Id }}</td>
                <td>{{ donation.Name }}</td>
                <td>{{ donation.Description }}</td>
                <td>{{ donation.Details }}</td>
                <td>
                    <img [src]="IMAGE_BASE_URL_GIFT + donation.Picture" style="width: 50px" class="shadow-2 rounded" />
                </td>
                <td>{{ donation.purchase_quentity }}</td>
                <td>{{ donation.Value }}</td>
                <td>
                    <p-button icon="pi pi-pencil" (onClick)="editGift(donation)" [rounded]="true" [outlined]="true" class="mr-2" />
                </td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="10">There are no donations for this donor yet.</td>
            </tr>
        </ng-template>
    </p-table>
</div>
